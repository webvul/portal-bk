<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:mvc="http://www.springframework.org/schema/mvc"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/mvc
       http://www.springframework.org/schema/mvc/spring-mvc.xsd">

	<import resource="classpath:com/kii/beehive/portal/web/portalContext.xml" />

	<mvc:annotation-driven />



	<context:component-scan base-package="com.kii.beehive.portal.web.controller">
	</context:component-scan>

	<!-- <bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"> 
		<property name="messageConverters"> <util:list id="beanList"> <ref bean="stringHttpMessageConverter"/> 
		<ref bean="marshallingHttpMessageConverter"/> </util:list> </property> </bean> 
		<bean id="marshallingHttpMessageConverter" class="org.springframework.http.converter.xml.MarshallingHttpMessageConverter"> 
		<property name="marshaller" ref="castorMarshaller"/> <property name="unmarshaller" 
		ref="castorMarshaller"/> </bean> -->

	<bean id="jsonViewResolver"
		  class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver">
		<property name="defaultViews">
			<list>
				<bean
						class="org.springframework.web.servlet.view.json.MappingJackson2JsonView" />
			</list>
		</property>
		<property name="viewResolvers">
			<list>
				<bean class="org.springframework.web.servlet.view.BeanNameViewResolver" />
			</list>
		</property>
	</bean>


	<mvc:cors>
		<mvc:mapping path="/**" allowed-origins="*"
					 allowed-methods="GET, PUT,POST,PATCH,DELETE" max-age="3600" />
	</mvc:cors>
	<mvc:interceptors>
		<mvc:interceptor>
			<mvc:mapping path="/**" />
			<bean class="com.kii.beehive.portal.web.help.OperatorLogInterceptor"></bean>
		</mvc:interceptor>

		<!--intercept all API related to users-->
		<mvc:interceptor>
			<mvc:mapping path="/users" />
			<mvc:mapping path="/users/**" />
			<bean class="com.kii.beehive.portal.web.help.TokenInterceptor" />
		</mvc:interceptor>

		<!--intercept all API related to users/usergroup/things/tags-->
		<mvc:interceptor>
			<!--users-->
			<mvc:mapping path="/users" />
			<mvc:mapping path="/users/**" />
			<!--usergroup-->
			<mvc:mapping path="/usergroup" />
			<mvc:mapping path="/usergroup/**" />
			<!--things-->
			<mvc:mapping path="/things" />
			<mvc:mapping path="/things/**" />
			<!--tags-->
			<mvc:mapping path="/tags" />
			<mvc:mapping path="/tags/**" />
			<!--change password-->
			<mvc:mapping path="/oauth2/changepassword" />
			<!-- exclude login API-->
			<mvc:exclude-mapping path="/oauth2/login"/>
			<mvc:exclude-mapping path="/oauth2/logout"/>

			<bean class="com.kii.beehive.portal.web.help.AuthInterceptor" />
		</mvc:interceptor>

	</mvc:interceptors>

</beans>